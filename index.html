<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Memoria de NÃºmeros</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;overflow-x:hidden}
body{font-family:Georgia,serif;background:linear-gradient(135deg,#0a0e27,#1a1034,#2d1b4e);min-height:100vh;color:#e8e8f0;display:flex;flex-direction:column;align-items:center;padding:8px;-webkit-tap-highlight-color:transparent}
.title{font-size:1.4em;background:linear-gradient(135deg,#ffd700,#ff8c00);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-align:center}
.subtitle{color:#d4af37;margin-bottom:6px;font-size:0.8em}
.box{background:rgba(255,255,255,0.05);border:2px solid rgba(212,175,55,0.5);border-radius:12px;padding:10px;width:calc(100% - 16px);max-width:340px}
.hidden{display:none!important}
.banner{background:rgba(255,215,0,0.2);border:1px solid rgba(255,215,0,0.5);color:#ffd700;padding:4px 8px;border-radius:8px;font-size:0.7em}
.back{padding:4px 8px;background:rgba(255,255,255,0.1);border:1px solid rgba(212,175,55,0.3);border-radius:8px;color:#ffd700;text-decoration:none;font-size:0.7em}
.top-bar{width:calc(100% - 16px);max-width:340px;display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.popup-bg{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.85);display:flex;justify-content:center;align-items:center;z-index:5000;padding:12px}
.popup{background:linear-gradient(135deg,#1a1034,#2d1b4e);border:2px solid rgba(255,215,0,0.3);border-radius:12px;padding:16px;width:90%;max-width:260px;text-align:center}
.popup h3{color:#e8e8f0;margin-bottom:4px;font-size:0.95em}
.popup p{color:#a0a0b8;font-size:0.75em;margin-bottom:12px}
.popup a{display:block;padding:8px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.2);border-radius:6px;color:#e8e8f0;text-decoration:none;margin-bottom:10px;font-size:0.8em}
.popup button{width:100%;background:linear-gradient(135deg,#ffd700,#ff8c00);color:#1a1034;border:none;padding:8px;border-radius:12px;font-weight:bold;cursor:pointer;font-size:0.85em}
.pin-title{color:#ffd700;font-size:1em;text-align:center;margin-bottom:4px}
.pin-sub{color:#b8b8cc;text-align:center;margin-bottom:12px;font-size:0.75em}
.dots{display:flex;justify-content:center;gap:8px;margin-bottom:12px}
.dot{width:12px;height:12px;border-radius:50%;border:2px solid rgba(212,175,55,0.5)}
.dot.on{background:#ffd700;border-color:#ffd700}
.keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:5px;max-width:180px;margin:0 auto 10px}
.key{aspect-ratio:1;font-size:1.1em;border:2px solid rgba(212,175,55,0.3);background:rgba(255,255,255,0.05);color:#e8e8f0;border-radius:6px;cursor:pointer}
.key:active{transform:scale(0.95)}
.key.empty{visibility:hidden}
.msg{text-align:center;min-height:16px;font-size:0.75em}
.msg.err{color:#ff6b6b}
.msg.ok{color:#4ecdc4}
.toggle{text-align:center;margin-top:10px;color:#b8b8cc;font-size:0.75em}
.toggle span{color:#ffd700;cursor:pointer;text-decoration:underline}
.btn{width:100%;background:linear-gradient(135deg,#ffd700,#ff8c00);color:#1a1034;border:none;padding:10px;border-radius:15px;font-size:0.85em;font-weight:bold;cursor:pointer;margin-top:5px;font-family:Georgia,serif}
.btn:active{transform:scale(0.98)}
.btn2{background:linear-gradient(135deg,#8a2be2,#4b0082);color:#fff}
.welcome{background:rgba(255,215,0,0.1);border:1px solid rgba(255,215,0,0.3);border-radius:8px;padding:10px;margin-bottom:10px;text-align:center}
.welcome h3{color:#ffd700;margin-bottom:2px;font-size:0.95em}
.welcome p{font-size:0.75em;color:#b8b8cc}
.stats{display:grid;grid-template-columns:repeat(2,1fr);gap:6px;margin:10px 0}
.stat{background:rgba(255,255,255,0.05);padding:8px;border-radius:6px;text-align:center;border:1px solid rgba(212,175,55,0.2)}
.stat b{display:block;font-size:1.2em;color:#ffd700}
.stat span{color:#b8b8cc;font-size:0.65em}
.game-info{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;padding:0 5px}
.game-stat{text-align:center}
.game-stat b{display:block;font-size:1.1em;color:#ffd700}
.game-stat span{color:#b8b8cc;font-size:0.65em}
.number-display{background:rgba(0,0,0,0.3);border-radius:12px;padding:30px 15px;margin:15px 0;text-align:center}
.number-show{font-size:2.5em;color:#ffd700;font-weight:bold;letter-spacing:8px;font-family:monospace}
.number-input{width:100%;padding:12px;background:rgba(255,255,255,0.1);border:2px solid rgba(212,175,55,0.5);border-radius:8px;color:#ffd700;font-size:1.5em;font-family:monospace;text-align:center;letter-spacing:5px}
.number-input:focus{outline:none;border-color:#ffd700}
.number-input::placeholder{color:#666;letter-spacing:2px}
.status-msg{text-align:center;color:#ffd700;font-size:0.9em;margin:10px 0;min-height:24px}
.progress-bar{width:100%;height:6px;background:rgba(255,255,255,0.1);border-radius:3px;margin:10px 0;overflow:hidden}
.progress-fill{height:100%;background:linear-gradient(90deg,#ffd700,#ff8c00);transition:width 0.1s linear}
.res-bg{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.9);display:flex;justify-content:center;align-items:center;z-index:3000;padding:12px}
.res{background:linear-gradient(135deg,#1a1034,#2d1b4e);border:2px solid #ffd700;border-radius:12px;padding:16px 12px;width:90%;max-width:300px;text-align:center}
.res h2{color:#ffd700;margin-bottom:6px;font-size:1.1em}
.res-score{font-size:2.5em;color:#ffd700;font-weight:bold}
.res-label{color:#b8b8cc;margin-bottom:10px;font-size:0.8em}
.res-details{display:flex;justify-content:space-around;margin:10px 0}
.res-detail{text-align:center}
.res-detail b{display:block;color:#ffd700;font-size:1.2em}
.res-detail span{color:#b8b8cc;font-size:0.7em}
.record{background:rgba(255,215,0,0.2);border:1px solid #ffd700;border-radius:5px;padding:6px;margin:8px 0;color:#ffd700;font-weight:bold;font-size:0.85em}
.rating{color:#d4af37;margin-bottom:10px;font-size:0.85em}
.name-input{width:100%;padding:10px;background:rgba(255,255,255,0.1);border:2px solid rgba(212,175,55,0.5);border-radius:8px;color:#e8e8f0;font-size:1em;font-family:Georgia,serif;margin-bottom:10px;text-align:center}
.name-input:focus{outline:none;border-color:#ffd700}
.name-input::placeholder{color:#888}
</style>
</head>
<body>
<div class="top-bar"><a href="https://hooporiapr-oss.github.io/akashic-works/" class="back">Inicio</a><div class="banner" id="bannerEl">3 gratis</div></div>
<div class="title">Memoria de NÃºmeros</div>
<div class="subtitle">Puerto Rico</div>

<!-- Login Box -->
<div class="box" id="loginBox">
<div class="pin-title">Ingresa tu PIN</div>
<div class="pin-sub">Escribe tu PIN de 4 dÃ­gitos</div>
<div class="dots"><div class="dot" id="d1"></div><div class="dot" id="d2"></div><div class="dot" id="d3"></div><div class="dot" id="d4"></div></div>
<div class="keypad" id="loginPad"></div>
<div class="msg" id="loginMsg"></div>
<div class="toggle">Â¿No tienes cuenta? <span id="toCreate">Crear PIN</span></div>
</div>

<!-- Create PIN Box -->
<div class="box hidden" id="createBox">
<div class="pin-title" id="createTitle">Crear PIN</div>
<div class="pin-sub" id="createSub">Escoge un PIN de 4 dÃ­gitos</div>
<div class="dots"><div class="dot" id="c1"></div><div class="dot" id="c2"></div><div class="dot" id="c3"></div><div class="dot" id="c4"></div></div>
<div class="keypad" id="createPad"></div>
<div class="msg" id="createMsg"></div>
<div class="toggle">Â¿Ya tienes PIN? <span id="toLogin">Entrar</span></div>
</div>

<!-- Name Setup Box -->
<div class="box hidden" id="nameBox">
<div class="pin-title">Nombre de Usuario</div>
<div class="pin-sub">Escoge un nombre para la tabla de lÃ­deres</div>
<input type="text" class="name-input" id="nameInput" placeholder="Tu nombre" maxlength="15">
<button class="btn" id="saveNameBtn">Guardar Nombre</button>
<div class="msg" id="nameMsg"></div>
</div>

<!-- Dashboard -->
<div class="box hidden" id="dashBox">
<div class="welcome"><h3 id="welcomeName">Â¡Bienvenido!</h3><p>Recuerda los nÃºmeros mostrados</p></div>
<div class="stats"><div class="stat"><b id="dGames">0</b><span>Juegos</span></div><div class="stat"><b id="dBest">--</b><span>Mejor Nivel</span></div><div class="stat"><b id="dAvg">--</b><span>Promedio</span></div><div class="stat"><b id="dRate">--</b><span>Nivel</span></div></div>
<button class="btn" id="startBtn">Comenzar</button>
<button class="btn btn2" id="logoutBtn">Salir</button>
</div>

<!-- Game Box -->
<div class="box hidden" id="gameBox">
<div class="game-info"><div class="game-stat"><b id="gLevel">1</b><span>Nivel</span></div><div class="game-stat"><b id="gDigits">3</b><span>DÃ­gitos</span></div><div class="game-stat"><b id="gScore">0</b><span>Puntos</span></div></div>
<div class="status-msg" id="statusMsg">Memoriza el nÃºmero...</div>
<div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
<div class="number-display">
<div class="number-show" id="numberShow">123</div>
<input type="tel" class="number-input hidden" id="numberInput" placeholder="Escribe el nÃºmero" maxlength="15">
</div>
<button class="btn hidden" id="submitBtn">Enviar</button>
<button class="btn btn2" id="quitBtn">Salir</button>
</div>

<!-- Results -->
<div class="res-bg hidden" id="resBg">
<div class="res">
<h2>Â¡Fin del Juego!</h2>
<div class="res-score" id="resLevel">0</div>
<div class="res-label">Nivel Alcanzado</div>
<div class="res-details"><div class="res-detail"><b id="resDigits">0</b><span>MÃ¡x DÃ­gitos</span></div><div class="res-detail"><b id="resScore">0</b><span>Puntos</span></div></div>
<div class="record hidden" id="resRecord">Â¡Nuevo RÃ©cord!</div>
<div class="rating" id="resRating">Nivel: --</div>
<button class="btn" id="againBtn">Jugar Otra Vez</button>
<button class="btn btn2" id="menuBtn">MenÃº</button>
</div>
</div>

<!-- Limit Popup -->
<div class="popup-bg hidden" id="limitPopup">
<div class="popup">
<h3 id="limitTitle">LÃ­mite diario alcanzado</h3>
<p id="limitMsg">Usaste tus 3 juegos gratis hoy</p>
<a href="https://hooporiapr-oss.github.io/akashic-works/">Volver al Inicio</a>
<button id="upgradeBtn">Desbloquear Ilimitado</button>
</div>
</div>

<script>
(function(){
    var PK = "ak_pins";
    var UK = "ak_users";
    var SK = "nmes2_stats_";
    var DK = "ak_dev";
    var MAX_DAILY = 3;
    var MAX_DAYS = 3;
    
    var currentPin = "";
    var currentUser = null;
    var level = 1;
    var score = 0;
    var currentNumber = "";
    var showTime = 2000;
    var timerInterval = null;
    
    function $(id) { return document.getElementById(id); }
    
    function hash(p) {
        var h = 0;
        var s = p + "akashic";
        for (var i = 0; i < s.length; i++) {
            h = ((h << 5) - h) + s.charCodeAt(i);
            h = h & h;
        }
        return h.toString(36);
    }
    
    function getPins() {
        try { return JSON.parse(localStorage.getItem(PK)) || {}; }
        catch (e) { return {}; }
    }
    
    function savePins(p) { localStorage.setItem(PK, JSON.stringify(p)); }
    
    function checkPin(p) { return !!getPins()[hash(p)]; }
    
    function savePin(p) {
        var pins = getPins();
        pins[hash(p)] = { created: Date.now() };
        savePins(pins);
    }
    
    function getUsers() {
        try { return JSON.parse(localStorage.getItem(UK)) || {}; }
        catch (e) { return {}; }
    }
    
    function saveUsers(u) { localStorage.setItem(UK, JSON.stringify(u)); }
    
    function getUser(pinHash) {
        return getUsers()[pinHash] || null;
    }
    
    function saveUser(pinHash, userData) {
        var users = getUsers();
        users[pinHash] = userData;
        saveUsers(users);
    }
    
    function getDeviceId() {
        var id = localStorage.getItem(DK);
        if (!id) {
            id = "dev_" + Date.now() + "_" + Math.random().toString(36).substr(2, 9);
            localStorage.setItem(DK, id);
        }
        return id;
    }
    
    function getToday() {
        var d = new Date();
        return d.getFullYear() + "-" + (d.getMonth() + 1) + "-" + d.getDate();
    }
    
    function getDeviceTries() {
        var key = "ak_trial_nm";
        try {
            var t = JSON.parse(localStorage.getItem(key));
            if (t && t.startDate) return t;
        } catch (e) {}
        return { n: 0, d: getToday(), startDate: getToday() };
    }
    
    function setDeviceTries(t) {
        localStorage.setItem("ak_trial_nm", JSON.stringify(t));
    }
    
    function getDaysDiff(startDate) {
        var start = new Date(startDate);
        var now = new Date();
        return Math.floor((now - start) / (1000 * 60 * 60 * 24));
    }
    
    function canPlay() {
        var t = getDeviceTries();
        var today = getToday();
        var daysSinceStart = getDaysDiff(t.startDate);
        
        if (daysSinceStart >= MAX_DAYS) {
            return { ok: false, left: 0, expired: true, daysLeft: 0 };
        }
        
        if (t.d !== today) {
            t.n = 0;
            t.d = today;
            setDeviceTries(t);
        }
        
        return {
            ok: t.n < MAX_DAILY,
            left: MAX_DAILY - t.n,
            expired: false,
            daysLeft: MAX_DAYS - daysSinceStart
        };
    }
    
    function useTry() {
        var t = getDeviceTries();
        var today = getToday();
        if (t.d !== today) {
            t.n = 0;
            t.d = today;
        }
        t.n++;
        setDeviceTries(t);
        showBanner();
    }
    
    function getStats() {
        try {
            return JSON.parse(localStorage.getItem(SK + hash(currentPin))) || { games: 0, bestLevel: 0, totalLevel: 0 };
        } catch (e) {
            return { games: 0, bestLevel: 0, totalLevel: 0 };
        }
    }
    
    function setStats(s) {
        localStorage.setItem(SK + hash(currentPin), JSON.stringify(s));
    }
    
    function showBanner() {
        var c = canPlay();
        if (c.expired) {
            $("bannerEl").textContent = "Prueba terminada";
        } else {
            $("bannerEl").textContent = c.left + "/" + MAX_DAILY + " (DÃ­a " + c.daysLeft + ")";
        }
    }
    
    function showLimit() {
        var c = canPlay();
        if (c.expired) {
            $("limitTitle").textContent = "Prueba gratis terminada";
            $("limitMsg").textContent = "Tu prueba gratis de 3 dÃ­as ha expirado";
        } else {
            $("limitTitle").textContent = "LÃ­mite diario alcanzado";
            $("limitMsg").textContent = "Usaste " + MAX_DAILY + " juegos gratis hoy. " + c.daysLeft + " dÃ­a(s) restantes.";
        }
        $("limitPopup").classList.remove("hidden");
    }
    
    function show(id) {
        ["loginBox", "createBox", "nameBox", "dashBox", "gameBox"].forEach(function(x) {
            $(x).classList.add("hidden");
        });
        $(id).classList.remove("hidden");
    }
    
    function setDots(pre, n) {
        for (var i = 1; i <= 4; i++) {
            var el = $(pre + i);
            if (el) {
                if (i <= n) el.classList.add("on");
                else el.classList.remove("on");
            }
        }
    }
    
    function setMsg(id, t, isErr) {
        var m = $(id);
        m.textContent = t;
        m.className = "msg " + (isErr ? "err" : "ok");
    }
    
    function getRating(lvl) {
        if (!lvl || lvl < 1) return "--";
        if (lvl >= 10) return "Genio";
        if (lvl >= 8) return "Experto";
        if (lvl >= 6) return "Excelente";
        if (lvl >= 4) return "Bueno";
        return "Aprendiz";
    }
    
    var loginPin = "";
    var createPin = "";
    var confirmPin = "";
    var isConfirming = false;
    
    function buildKeypad(containerId, onDigit, onDelete) {
        var container = $(containerId);
        container.innerHTML = "";
        
        for (var i = 1; i <= 9; i++) {
            (function(digit) {
                var btn = document.createElement("button");
                btn.className = "key";
                btn.textContent = digit;
                btn.onclick = function() { onDigit(digit); };
                container.appendChild(btn);
            })(i);
        }
        
        var empty = document.createElement("button");
        empty.className = "key empty";
        container.appendChild(empty);
        
        var zero = document.createElement("button");
        zero.className = "key";
        zero.textContent = "0";
        zero.onclick = function() { onDigit(0); };
        container.appendChild(zero);
        
        var del = document.createElement("button");
        del.className = "key";
        del.textContent = "â†";
        del.onclick = onDelete;
        container.appendChild(del);
    }
    
    function setupLogin() {
        buildKeypad("loginPad", function(digit) {
            if (loginPin.length < 4) {
                loginPin += digit;
                setDots("d", loginPin.length);
                if (loginPin.length === 4) {
                    setTimeout(function() {
                        if (checkPin(loginPin)) {
                            currentPin = loginPin;
                            currentUser = getUser(hash(currentPin));
                            if (currentUser && currentUser.name) {
                                loadDash();
                            } else {
                                show("nameBox");
                            }
                        } else {
                            setMsg("loginMsg", "PIN incorrecto", true);
                            loginPin = "";
                            setDots("d", 0);
                        }
                    }, 200);
                }
            }
        }, function() {
            if (loginPin.length > 0) {
                loginPin = loginPin.slice(0, -1);
                setDots("d", loginPin.length);
                $("loginMsg").textContent = "";
            }
        });
    }
    
    function setupCreate() {
        buildKeypad("createPad", function(digit) {
            if (confirmPin.length < 4) {
                confirmPin += digit;
                setDots("c", confirmPin.length);
                if (confirmPin.length === 4) {
                    setTimeout(function() {
                        if (!isConfirming) {
                            createPin = confirmPin;
                            confirmPin = "";
                            isConfirming = true;
                            $("createTitle").textContent = "Confirmar PIN";
                            $("createSub").textContent = "Escribe el PIN otra vez";
                            setDots("c", 0);
                        } else {
                            if (confirmPin === createPin) {
                                savePin(createPin);
                                currentPin = createPin;
                                setMsg("createMsg", "Â¡PIN creado!", false);
                                setTimeout(function() {
                                    show("nameBox");
                                }, 500);
                            } else {
                                setMsg("createMsg", "PINs no coinciden", true);
                                createPin = "";
                                confirmPin = "";
                                isConfirming = false;
                                $("createTitle").textContent = "Crear PIN";
                                $("createSub").textContent = "Escoge un PIN de 4 dÃ­gitos";
                                setDots("c", 0);
                            }
                        }
                    }, 200);
                }
            }
        }, function() {
            if (confirmPin.length > 0) {
                confirmPin = confirmPin.slice(0, -1);
                setDots("c", confirmPin.length);
                $("createMsg").textContent = "";
            }
        });
    }
    
    function loadDash() {
        var s = getStats();
        $("welcomeName").textContent = "Â¡Bienvenido, " + (currentUser ? currentUser.name : "Jugador") + "!";
        $("dGames").textContent = s.games || 0;
        $("dBest").textContent = s.bestLevel || "--";
        $("dAvg").textContent = s.games > 0 ? Math.round(s.totalLevel / s.games) : "--";
        $("dRate").textContent = getRating(s.bestLevel);
        show("dashBox");
        showBanner();
        if (!canPlay().ok) showLimit();
    }
    
    function generateNumber(digits) {
        var num = "";
        for (var i = 0; i < digits; i++) {
            if (i === 0) {
                num += Math.floor(Math.random() * 9) + 1;
            } else {
                num += Math.floor(Math.random() * 10);
            }
        }
        return num;
    }
    
    function getDigitsForLevel(lvl) {
        return Math.min(2 + lvl, 15);
    }
    
    function startRound() {
        var digits = getDigitsForLevel(level);
        currentNumber = generateNumber(digits);
        showTime = 1000 + (digits * 500);
        
        $("gLevel").textContent = level;
        $("gDigits").textContent = digits;
        $("statusMsg").textContent = "Memoriza el nÃºmero...";
        $("numberShow").textContent = currentNumber;
        $("numberShow").classList.remove("hidden");
        $("numberInput").classList.add("hidden");
        $("numberInput").value = "";
        $("submitBtn").classList.add("hidden");
        $("progressFill").style.width = "100%";
        
        var startTime = Date.now();
        if (timerInterval) clearInterval(timerInterval);
        
        timerInterval = setInterval(function() {
            var elapsed = Date.now() - startTime;
            var remaining = Math.max(0, 100 - (elapsed / showTime * 100));
            $("progressFill").style.width = remaining + "%";
            
            if (elapsed >= showTime) {
                clearInterval(timerInterval);
                showInput();
            }
        }, 50);
    }
    
    function showInput() {
        $("statusMsg").textContent = "Â¡Escribe el nÃºmero!";
        $("numberShow").classList.add("hidden");
        $("numberInput").classList.remove("hidden");
        $("numberInput").focus();
        $("submitBtn").classList.remove("hidden");
        $("progressFill").style.width = "0%";
    }
    
    function checkAnswer() {
        var answer = $("numberInput").value.trim();
        
        if (answer === currentNumber) {
            score += level * 10;
            $("gScore").textContent = score;
            $("statusMsg").textContent = "Â¡Correcto! ðŸŽ‰";
            level++;
            setTimeout(startRound, 1000);
        } else {
            $("statusMsg").textContent = "Â¡Error! Era " + currentNumber;
            setTimeout(endGame, 2000);
        }
    }
    
    function startGame() {
        if (!canPlay().ok) {
            showLimit();
            return;
        }
        
        level = 1;
        score = 0;
        $("gScore").textContent = "0";
        show("gameBox");
        startRound();
    }
    
    function endGame() {
        if (timerInterval) clearInterval(timerInterval);
        
        var s = getStats();
        s.games++;
        s.totalLevel += level;
        var isRecord = level > (s.bestLevel || 0);
        if (isRecord) s.bestLevel = level;
        setStats(s);
        
        useTry();
        
        $("resLevel").textContent = level;
        $("resDigits").textContent = getDigitsForLevel(level);
        $("resScore").textContent = score;
        $("resRating").textContent = "Nivel: " + getRating(level);
        
        if (isRecord) {
            $("resRecord").classList.remove("hidden");
        } else {
            $("resRecord").classList.add("hidden");
        }
        
        $("resBg").classList.remove("hidden");
        
        if (!canPlay().ok) {
            setTimeout(showLimit, 1500);
        }
    }
    
    document.addEventListener("DOMContentLoaded", function() {
        getDeviceId();
        setupLogin();
        setupCreate();
        
        $("toCreate").onclick = function() {
            createPin = "";
            confirmPin = "";
            isConfirming = false;
            $("createTitle").textContent = "Crear PIN";
            $("createSub").textContent = "Escoge un PIN de 4 dÃ­gitos";
            setDots("c", 0);
            $("createMsg").textContent = "";
            show("createBox");
        };
        
        $("toLogin").onclick = function() {
            loginPin = "";
            setDots("d", 0);
            $("loginMsg").textContent = "";
            show("loginBox");
        };
        
        $("saveNameBtn").onclick = function() {
            var name = $("nameInput").value.trim();
            if (name.length < 2) {
                setMsg("nameMsg", "Nombre muy corto (mÃ­n 2)", true);
                return;
            }
            if (name.length > 15) {
                setMsg("nameMsg", "Nombre muy largo (mÃ¡x 15)", true);
                return;
            }
            
            currentUser = { name: name, created: Date.now() };
            saveUser(hash(currentPin), currentUser);
            loadDash();
        };
        
        $("startBtn").onclick = function() {
            if (!canPlay().ok) {
                showLimit();
                return;
            }
            startGame();
        };
        
        $("logoutBtn").onclick = function() {
            loginPin = "";
            currentPin = "";
            currentUser = null;
            setDots("d", 0);
            show("loginBox");
        };
        
        $("quitBtn").onclick = function() {
            if (timerInterval) clearInterval(timerInterval);
            loadDash();
        };
        
        $("submitBtn").onclick = checkAnswer;
        
        $("numberInput").addEventListener("keypress", function(e) {
            if (e.key === "Enter") {
                checkAnswer();
            }
        });
        
        $("againBtn").onclick = function() {
            $("resBg").classList.add("hidden");
            if (!canPlay().ok) {
                showLimit();
                return;
            }
            startGame();
        };
        
        $("menuBtn").onclick = function() {
            $("resBg").classList.add("hidden");
            loadDash();
        };
        
        $("upgradeBtn").onclick = function() {
            window.location.href = "mailto:support@akashic.works?subject=Pro%20Upgrade";
        };
        
        show("loginBox");
        showBanner();
    });
})();
</script>
</body>
</html>
